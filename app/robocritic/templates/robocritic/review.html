{% extends 'robocritic/base.html' %}

{% block content %}
<div class="container mx-auto p-6 max-w-7xl">
    <h2 class="text-2xl font-bold mb-4 text-gray-950">{{ game.title }}</h2>
    
    <!-- Main grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <!-- Left column: Image and Buy section -->
        <div class="flex flex-col space-y-4">
            <!-- Image section -->
                <img class="w-full max-w-2xl h-auto aspect-square object-cover rounded-lg shadow-lg" 
                     src="{{ game.art_url }}" 
                     alt="{{ game.title }}">
        </div>

        <!-- Right column: Review cards section -->
        <div>
            <div class="gap-4 text-gray-950 mb-4">
                <!-- Header row -->
                <div class="px-1 flex">
                    <span class="font-semibold">Publisher</span>
                    <div class="flex flex w-full justify-end gap-x-8">
                        <span class="font-semibold">Critic</span>
                        <span class="font-semibold">AI</span>
                    </div>
                </div>
                {% for review in reviews %}
                <div class="rounded-lg border-2 {% if forloop.first %}border-blue-400{% else %}border-gray-200{% endif %} hover:border-blue-400 cursor-pointer transition-all duration-200"
                     onclick="toggleReview('review-{{ review.id }}', this)">
                    <div class="flex">
                        <!-- Publisher section -->
                         <div class="w-1/4">

                             <a href="{{ review.review_url }}" 
                                class="text-blue-600 hover:text-blue-400 transition-colors duration-200">
                                 {{ review.publisher }}
                             </a>

                         </div>
                        <div class="flex w-3/4 justify-end gap-x-8">
                            <!-- Scores sections -->
                            <span>{{ review.critic_score }}</span>
                            <span>{{ review.robo_score }}</span>
                        </div>
                    </div>
                </div>
                {% empty %}
                <p>No reviews available.</p>
                {% endfor %}
            </div>

            <!-- Pros/Cons for selected review -->
            {% for review in reviews %}
            <div id="review-{{ review.id }}" class="{% if not forloop.first %}hidden{% endif %} w-full p-4 border-4 border-solid rounded-lg text-gray-950">
                <div>
                    {% if review.reviewpro_set.all %}
                    <div>
                        <h3 class="font-semibold text-xl mb-2">Pros:</h3>
                        <ul class="list-disc list-inside">
                            {% for pro in review.reviewpro_set.first.pros %}
                            <li>{{ pro }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}

                    {% if review.reviewcon_set.all %}
                    <div>
                        <h3 class="font-semibold text-xl mb-2">Cons:</h3>
                        <ul class="list-disc list-inside">
                            {% for con in review.reviewcon_set.first.cons %}
                            <li>{{ con }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Bottom section: Video -->
        <iframe 
            class="w-full max-w-2xl h-auto aspect-video mt-8 rounded-lg shadow-lg"
            src="{{ game.youtube_gameplay_url }}"
            title="{{ game.title }} Gameplay"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen>
        </iframe>
</div>

<script>
    function toggleReview(reviewId, clickedElement) {
        // Remove active state from all cards
        document.querySelectorAll('[onclick^="toggleReview"]').forEach(el => {
            el.classList.remove('border-blue-400');
            el.classList.add('border-gray-200');
        });
        
        // Hide all review details
        document.querySelectorAll('[id^="review-"]').forEach(el => {
            el.classList.add('hidden');
        });
        
        // Show the selected review and highlight the clicked card
        const review = document.getElementById(reviewId);
        review.classList.remove('hidden');
        clickedElement.classList.remove('border-gray-200');
        clickedElement.classList.add('border-blue-400');
    }
</script>
{% endblock %}